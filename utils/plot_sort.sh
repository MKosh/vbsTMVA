#!/bin/bash

# Run before new plots are generated and overwrite the old ones
#	Purpose:
#		- Sorts the plots generated by the framework
#		- Moves old ones to the corresponding "plots/####/archive" folder, increments a number and adds it to the end of the file name
#		- Works on both the pdf's and png's the framework spits out
#
#	Usage:
#		./plot_sort.sh "year"

if [[ $1 == 2016 || $1 == 2017 || $1 == 2018 || $1 == old ]]; then

	echo "Starting plot sort"
	for file in ../plots/$1/*.pdf; do
		end=$(echo $file | sed 's|^.*\([0-9]\{4\}_\)||g' | sed 's|.pdf||g') # 'end' pulls out the end of the file name which corresponds to the cutName used
		canvas=$(echo $file | sed 's|_\([0-9]\{4\}\).*$||g' | sed 's|^.*\([0-9]\{4\}/\)||g') # canvas c1, c2, or c3
		current=$(find ../plots/$1/archive/*$end*.pdf | grep $canvas | sed "s|^.*\($end\)||g" | sed 's|.pdf||g' | sort -rn | head -n 1) # Current highest number for the plots using the same cut
		new=$((current+1)) # Increment the 'current' highest number on a plot for the new ones
		newFile=$(echo $file | sed "s|.pdf|$new.pdf|g" | sed "s|../plots/$1/||g") # rename the plot with the new number appended to the end
		mv $file ../plots/$1/archive/$newFile # move the file to the appropriate archive folder
	done

	echo "Done sorting .pdf's, next is .png's"

	for file in ../plots/$1/*.png; do
                end=$(echo $file | sed 's|^.*\([0-9]\{4\}_\)||g' | sed 's|.pdf||g')
                canvas=$(echo $file | sed 's|_\([0-9]\{4\}\).*$||g' | sed 's|^.*\([0-9]\{4\}/\)||g')
                current=$(find ../plots/$1/archive/*$end*.pdf | grep $canvas | sed "s|^.*\($end\)||g" | sed 's|.pdf||g' | sort -rn | head -n 1)
                new=$((current+1))
                newFile=$(echo $file | sed "s|.pdf|$new.pdf|g" | sed "s|../plots/$1/||g")
                mv $file ../plots/$1/archive/$newFile
        done
else	
	echo "I'm terribly confused, please check the plot_sort.sh script"
fi
